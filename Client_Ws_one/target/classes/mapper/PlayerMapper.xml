<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunting.ws.mapper.PlayerMapper">

    <select id="selectPlayerStatusByPlayerId" resultType="java.lang.Character">
        select status
        from ${dbName}.player
        where player_id = #{playerId}
    </select>

    <select id="selectPlayerByPlayerId" resultType="com.yunting.ws.entity.Player">
        select player_id,
               wx_open_id,
               pay_login_id,
               game_id,
               wx_nickname,
               real_name,
               wx_headimgurl,
               player_creat_time,
               proxy_name,
               status,
               mobile_id,
               in_red,
               special
        from ${dbName}.player
        where player_id = #{playerId}
    </select>

    <select id="selectInRedByPlayerId" resultType="java.math.BigDecimal">
        select in_red
        from ${dbName}.player
        where player_id = #{playerId}
          and game_id = #{gameId};
    </select>

    <insert id="addDayBehaveRecordlist">
        INSERT INTO ${dbName}.day_behave_recordlist ( player_id, app_id, retain_way, todayRed, totalRed
                                                    , today_encourageAdv_count, service_CallBack_AdvCount
                                                    , service_CallBack_Reward_Count, retain_time)
        VALUES (#{dayRecord.playerId}, #{dayRecord.appId}, #{dayRecord.retainWay}, #{dayRecord.todayred},
                #{dayRecord.totalred},
                #{dayRecord.todayEncourageAdvCount}, #{dayRecord.serviceCallBackAdvCount},
                #{dayRecord.serviceCallBackRewardCount}, #{dayRecord.retainTime})
    </insert>

    <insert id="updatePlayerDayrecord">
        update ${dbName}.day_behave_recordlist
        set retain_time = #{retainTime},
            is_retain=0
        where player_id = #{playerId}
          and date(retain_time) = #{date}
    </insert>

    <select id="getLastLocationByPlayerId" resultType="java.lang.String">
        select location
        from ${dbName}.location
        where player_id = #{playerId}
          and date(record_time) = #{today}
        order by locate_id desc
        limit 1
    </select>

    <update id="changePlayerPower">
        update ${dbName}.player
        set special = #{power}
        where player_id = #{playerId}
          and game_id = #{gameId}
    </update>

    <update id="changePlayerStatus">
        update ${dbName}.player
        set status = #{status}
        where player_id = #{playerId}
          and game_id = #{gameId}
    </update>

    <insert id="insert">
        insert into yunting_app_test.operation_recordlist (operation_id, wx_open_id, player_id, appid,
                                                           wx_nickname, operation_reason, operation_time,
                                                           operation_type)
        values (#{operationId}, #{wxOpenId,jdbcType=VARCHAR}, #{playerId,jdbcType=BIGINT}, #{appid},
            #{wxNickname,jdbcType=VARCHAR}, #{operationReason,jdbcType=VARCHAR},
                #{operationTime,jdbcType=TIMESTAMP},
                #{operationType})
    </insert>

    <select id="selectAliPayInfoByPlayerId" resultType="com.yunting.ws.entity.Player">
        select pay_login_id, real_name, in_red
        from ${dbName}.player
        where player_id = #{playerId}
          and game_id = #{gameId}
    </select>


    <select id="getFirstTaskListByPlayerIdAndGameID"
            resultType="com.yunting.ws.entity.ScreenshotTask">
        select bonus,
               task_process
        from ${dbName}.screenshot_task
        where player_id = #{playerId}
          and game_id = #{gameId}
        order by task_id
        limit 1
    </select>

</mapper>