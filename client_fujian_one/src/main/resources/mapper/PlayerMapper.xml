<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunting.client.mapper.Client.PlayerMapper">
    <resultMap id="BaseResultMap" type="com.yunting.client.entity.Player">
        <id column="player_id" jdbcType="BIGINT" property="playerId"/>
        <id column="wx_open_id" jdbcType="VARCHAR" property="wxOpenId"/>
        <id column="pay_login_id" jdbcType="VARCHAR" property="payLoginId"/>
        <result column="game_id" jdbcType="BIGINT" property="gameId"/>
        <result column="wx_nickname" jdbcType="VARCHAR" property="wxNickname"/>
        <result column="real_name" jdbcType="VARCHAR" property="realName"/>
        <result column="wx_headimgurl" jdbcType="VARCHAR" property="wxHeadimgurl"/>
        <result column="player_creat_time" jdbcType="TIMESTAMP" property="playerCreatTime"/>
        <result column="proxy_id" jdbcType="BIGINT" property="proxyId"/>
        <result column="status" jdbcType="CHAR" property="status"/>
        <result column="mobile_id" jdbcType="BIGINT" property="mobileId"/>
        <result column="in_red" jdbcType="DECIMAL" property="inRed"/>
        <result column="special" jdbcType="VARCHAR" property="special"/>
    </resultMap>

    <insert id="insertPlayer">
        insert into player
        (wx_open_id, game_id, wx_nickname, wx_headimgurl,
        player_creat_time, proxy_id, status,special,mobile_id,in_red)
        values (#{wxOpenId}, #{gameId}, #{wxNickname}, #{wxHeadimgurl},
        #{playerCreatTime}, #{proxyId},#{status},#{special},
        #{mobileId},#{inRed})
        <selectKey resultType="long" keyProperty="playerId" order="AFTER" keyColumn="player_id">
            select @@identity;
        </selectKey>
    </insert>

    <update id="updatePlayerMobileID">
        update player
        set mobile_id = #{mobileID}
        where player_id = #{playerId}
    </update>

    <update id="updatePlayerInRed">
        update player
        set in_red = in_red + #{inred}
        where player_id = #{playerId}
    </update>

    <update id="changePlayerPower">
        update player
        set special = #{power}
        where player_id = #{playerId}
          and game_id = #{gameId}
    </update>

    <update id="changePlayerStatus">
        update player
        set status = #{status}
        where player_id = #{playerId}
          and game_id = #{gameId}
    </update>

    <update id="refreshPlayerRealInfo">
        update player
        set real_name    = #{realName}
          , pay_login_id = #{payLoginId}
        where player_id = #{playerId}
    </update>

    <select id="selectPlayerByWxOpenId" resultType="com.yunting.client.entity.Player">
        select player_id,
               wx_open_id,
               game_id,
               wx_nickname,
               wx_headimgurl,
               status,
               special
        from player
        where wx_open_id = #{wxOpenId}
    </select>

    <select id="selectPlayersByGameId" resultType="java.lang.Long">
        select player_id
        from player
        where game_id = #{gameId}
        order by player_creat_time desc
    </select>

    <select id="selectPlayerStatusByWxOpenId" resultType="java.lang.Character">
        select status
        from player
        where wx_open_id = #{wxOpenId}
    </select>

    <select id="selectPlayerStatusByPlayerId" resultType="java.lang.Character">
        select status
        from player
        where player_id = #{playerId}
    </select>

    <select id="selectMobileIDByPlayerId" resultType="java.lang.Long">
        select mobile_id
        from player
        where player_id = #{playerId}
        limit 1
    </select>

    <select id="selectPlayerByPlayerId" resultType="com.yunting.client.entity.Player">
        select player_id,
               wx_open_id,
               pay_login_id,
               game_id,
               wx_nickname,
               real_name,
               wx_headimgurl,
               player_creat_time,
               proxy_id,
               status,
               mobile_id,
               in_red,
               special
        from player
        where player_id = #{playerId}
    </select>

    <select id="selectInRedByPlayerId" resultType="java.math.BigDecimal">
        select in_red
        from player
        where player_id = #{playerId}
          and game_id = #{gameId};
    </select>

    <select id="selectPlayerPowerAndStatus" resultType="com.yunting.client.entity.Player">
        select status, special
        from player
        where player_id = #{playerId}
          and game_id = #{gameId}
    </select>


    <select id="selectPlayersInQueryCondition" resultType="com.yunting.client.entity.Player">
        select player_id,
        wx_open_id,
        pay_login_id,
        game_id,
        wx_nickname,
        real_name,
        wx_headimgurl,
        player_creat_time,
        proxy_id,
        status,
        mobile_id,
        in_red,
        special
        from player
        where game_id = #{active.appid}
        <if test="active.selectOption != ''">

            <if test="active.selectOption == 1">
                <if test="active.search != ''">
                    and player_id=#{active.search}
                </if>
            </if>

            <if test="active.selectOption == 2">
                <if test="active.search != ''">
                    and wx_nickname=#{active.search}
                </if>
            </if>

            <if test="active.selectOption == 3">
                <if test="active.search != ''">
                    and date(player_creat_time)=curdate()
                </if>
            </if>

            <if test="active.selectOption == 4">
                <if test="active.search != ''">
                    and special=#{active.search}
                </if>
            </if>

            <if test="active.selectOption == 5">
                <if test="active.search != ''">
                    and status=#{active.search}
                </if>
            </if>
        </if>
        order by player_creat_time desc
    </select>


    <select id="selectPlayerByPayID" resultType="java.lang.Long">
        select player_id
        from player
        where pay_login_id = #{PayID}
    </select>
    <select id="selectPlayerByRealName" resultType="java.lang.Long">
        select player_id
        from player
        where real_name = #{RealName}
    </select>

    <select id="selectMobileNameByPlayerId" resultType="java.lang.String">
        select mobile_detail.device_name
        from mobile_detail
        where mobile_id = (select mobile_id from player where player_id = #{playerId})
    </select>

    <select id="selectAliPayInfoByPlayerId" resultType="com.yunting.client.entity.Player">
        select pay_login_id, real_name, in_red
        from player
        where player_id = #{playerId}
          and game_id = #{gameId}
    </select>

    <select id="selectWxNicknameByPlayerId" resultType="java.lang.String">
        select wx_nickname
        from player
        where player_id = #{playerId}
          and game_id = #{gameId}
    </select>

    <select id="getFirstTaskListByPlayerIdAndGameID"
            resultType="com.yunting.client.entity.ScreenshotTask">
        select bonus,
               task_process
        from yunting_app_test.screenshot_task
        where player_id = #{playerId}
          and game_id = #{gameId}
        order by task_id
        limit 1
    </select>


</mapper>